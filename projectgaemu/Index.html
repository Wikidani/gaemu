<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>proyect Gaemu</title>
    <link rel="stylesheet" type="text/css" href="Styles/style.css">
</head>
<header>
    <p><button onclick="canvas()">Try it</button></p>
    <p><button onclick="exportImage()">Export Image</button></p>
</header>

<body>
    <canvas id="canvas" width="600" height="600">
        Your browser does not support the HTML canvas tag.
    </canvas>
    <script>
        const images = [
            { id: "torso", path: "images/Torso A.png", layer: 1 },
            { id: "cabeza", path: "images/Cabeza A.png", layer: 2 },
            { id: "pelo", path: "images/Pelo B.png", layer: 3 }
        ];
        images.sort((a, b) => a.layer - b.layer);

        function canvas() {
            const c = document.getElementById("canvas");
            const ctx = c.getContext("2d");
            const tempCanvas = document.createElement("canvas");
            const tempCtx = tempCanvas.getContext("2d");

            for (let i = 0; i < images.length; i++) {
                const img = images[i]
                const image = new Image();
                image.src = img.path;
                image.onload = () => {
                    image.setAttribute('crossOrigin', 'anonymous');
                    tempCanvas.width = image.width;
                    tempCanvas.height = image.height;
                    tempCtx.drawImage(image, 0, 0);
                    ctx.drawImage(tempCanvas, 5, 5);
                };                
            }
        }

        function exportImage() {
            const c = document.getElementById("canvas");
            const imageData = c.toDataURL();

            localStorage.setItem("savedImageData", imageData);

            const link = document.createElement('a');
            link.href = imageData;
            link.download = 'exported_image.png';
            link.textContent = 'Download Image';
            document.body.appendChild(link);

            link.click();
        }
    </script>
</body>

</html>